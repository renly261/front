(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{bc9c:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",{staticClass:"q-pa-xl",attrs:{id:"adminMemberManage"}},[r("q-table",{attrs:{title:"會員管理",data:e.users,columns:e.columns,"row-key":"_id"},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"account",attrs:{props:t}},[e._v(e._s(t.row.account))]),r("q-td",{key:"password",attrs:{props:t}},[e._v(e._s(t.row.password))]),r("q-td",{key:"email",attrs:{props:t}},[e._v(e._s(t.row.email))]),r("q-td",{key:"address",attrs:{props:t}},[e._v(e._s(t.row.address))]),r("q-td",{key:"image",attrs:{props:t}},[r("q-img",{staticStyle:{width:"100%"},attrs:{src:t.row.image}})],1),r("q-td",{key:"role",attrs:{props:t}},[e._v(e._s(t.row.role))]),r("q-td",{key:"edit",attrs:{props:t}},[r("q-btn-group",{attrs:{outline:""}},[r("q-btn",{attrs:{outline:"",label:"編輯"},on:{click:function(r){return e.editProduct(t.rowIndex)}}}),r("q-btn",{attrs:{outline:"",label:"刪除"},on:{click:function(r){return e.delUser(t.rowIndex)}}}),r("q-dialog",{model:{value:e.edit,callback:function(t){e.edit=t},expression:"edit"}},[r("q-card",{staticClass:"my-card q-py-md",attrs:{flat:"",bordered:""}},[r("q-form",{staticClass:"q-gutter-xl"},[r("h5",{staticClass:"text-center q-pt-md"},[e._v("編輯會員")]),r("q-card-section",[r("q-input",{attrs:{filled:"",label:"會員名稱",required:"",hint:"可以使用",error:!e.state.account,"error-message":"帳號長度請在 4 ~ 20 個字之間"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1),r("q-card-section",[r("q-input",{attrs:{filled:"",label:"會員密碼",hint:"可以使用",error:!e.state.password,"error-message":"密碼長度請在 4 ~ 20 個字之間"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),r("q-card-section",[r("q-input",{attrs:{filled:"",label:"會員信箱",required:"",error:!e.state.email,"error-message":"請輸入正確的信箱格式"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),r("q-card-section",[r("q-input",{attrs:{filled:"",label:"使用者地址"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),r("q-card-section",[r("div",{staticClass:"q-gutter-xl text-center"},[r("img-inputer",{attrs:{theme:"dark",size:"large",placeholder:"點擊或拖曳選擇圖片","bottom-text":"點擊或拖曳以修改"},model:{value:e.form.image,callback:function(t){e.$set(e.form,"image",t)},expression:"form.image"}})],1)]),r("q-card-section",[r("q-input",{attrs:{filled:"",label:"會員權限",required:""},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}})],1),r("q-card-section",[r("div",{staticClass:"text-center"},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"送出",type:"submit",color:"primary"},on:{click:e.submitModal}}),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-ml-sm",attrs:{label:"關閉",type:"reset",color:"primary",flat:""}})],1)])],1)],1)],1)],1)],1)],1)]}}])})],1)},a=[],o=r("6374"),n=r.n(o),i=r("c973"),l=r.n(i),c=(r("96cf"),r("a434"),r("99af"),r("edd5")),d={name:"AdminMemberManage",data:function(){return{users:[],edit:!1,form:{account:"",password:"",email:"",address:"",image:"null",role:""},columns:[{name:"account",required:!0,label:"會員名稱",align:"center",field:"account",sortable:!0},{name:"password",align:"center",label:"會員密碼",field:"password",sortable:!0},{name:"email",align:"center",label:"會員信箱",field:"email",sortable:!0},{name:"address",label:"會員地址",field:"address",align:"center"},{name:"image",label:"會員頭像",field:"image",align:"center"},{name:"role",label:"會員權限",field:"role",align:"center"},{name:"edit",label:"會員管理",field:"edit",align:"center"}]}},computed:{state:function(){var e=this.form.account,t=this.form.password,r=this.form.email;return{account:0===e.length?null:e.length>=4&&e.length<=20,password:0===t.length?null:t.length>=4&&t.length<=20,email:0===r.length?null:Object(c["a"])(r)}}},methods:{delUser:function(e){var t=this;return l()(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.delete("/users/"+t.users[e]._id,{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 3:t.users.splice(e,1),r.next=10;break;case 6:r.prev=6,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"刪除會員失敗"}),console.log(r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,6]])})))()},editProduct:function(e){this.edit=!0,this.$set(this.form,"account",this.users[e].account),this.$set(this.form,"email",this.users[e].email),this.$set(this.form,"address",this.users[e].address),this.$set(this.form,"image",this.users[e].image),this.$set(this.form,"role",this.users[e].role),this.$set(this.form,"_id",this.users[e]._id),this.$set(this.form,"index",e)},submitModal:function(){var e=this;return l()(regeneratorRuntime.mark((function t(){var r,s,a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(s in t.prev=0,r=new FormData,e.form)r.append(s,e.form[s]);if(e.form.password===e.users[e.form.index].password){t.next=15;break}return t.next=6,e.axios.patch("/users/edit"+e.form._id,r,{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 6:a=t.sent,o=a.data,e.$set(e.users[e.form.index],"account",e.form.account),e.$set(e.users[e.form.index],"password",e.form.password),e.$set(e.users[e.form.index],"email",e.form.email),e.$set(e.users[e.form.index],"address",e.form.address),e.$set(e.users[e.form.index],"image","".concat("https://renly-eshop.herokuapp.com","/files/").concat(o.result.image)),e.$set(e.users[e.form.index],"role",e.form.role),e.$set(e.users[e.form.index],"_id",e.form._id);case 15:t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](0),e.$swal({icon:"error",title:"上傳錯誤"}),console.log(t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,17]])})))()}},mounted:function(){var e=this;return l()(regeneratorRuntime.mark((function t(){var r,s,a,o,i,l,c,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios.get("/users/all",{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 2:r=t.sent,s=r.data,a=n()(s.result);try{for(a.s();!(o=a.n()).done;)i=o.value,e.users.push(i)}catch(u){a.e(u)}finally{a.f()}l=n()(e.users);try{for(l.s();!(c=l.n()).done;)d=c.value,d.image="".concat("https://renly-eshop.herokuapp.com","/files/").concat(d.image)}catch(u){l.e(u)}finally{l.f()}case 8:case"end":return t.stop()}}),t)})))()}},u=d,m=r("2877"),f=r("9989"),p=r("eaac"),h=r("bd08"),g=r("db86"),b=r("068f"),w=r("e7a9"),q=r("9c40"),x=r("24e8"),v=r("f09f"),k=r("0378"),$=r("a370"),y=r("27f9"),_=r("7f67"),Q=r("eebe"),C=r.n(Q),M=Object(m["a"])(u,s,a,!1,null,null,null);t["default"]=M.exports;C()(M,"components",{QPage:f["a"],QTable:p["a"],QTr:h["a"],QTd:g["a"],QImg:b["a"],QBtnGroup:w["a"],QBtn:q["a"],QDialog:x["a"],QCard:v["a"],QForm:k["a"],QCardSection:$["a"],QInput:y["a"]}),C()(M,"directives",{ClosePopup:_["a"]})}}]);