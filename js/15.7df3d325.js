(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{1058:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-page",{staticClass:"q-pa-xl",attrs:{id:"cart"}},[r("q-table",{attrs:{title:"購物車",data:t.cart,columns:t.columns,"row-key":"_id",filter:t.filter,grid:"","hide-header":""},scopedSlots:t._u([{key:"top-right",fn:function(){return[r("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},scopedSlots:t._u([{key:"append",fn:function(){return[r("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]},proxy:!0},{key:"item",fn:function(e){return[r("div",{staticClass:"q-pa-md col-xs-12 col-md-6 col-lg-4"},[r("q-card",{class:e.selected?"bg-grey-2":""},[r("q-card-section",[r("div",{staticClass:"row"},[r("div",{staticClass:"col-12"},[r("q-img",{staticClass:"q-mt-xl",attrs:{src:e.row.image}})],1)]),r("div",{staticClass:"row",attrs:{id:"name"}},[r("div",{staticClass:"col-12"},[r("h4",{staticClass:"q-mt-xl text-center"},[t._v("商品名稱 : "+t._s(e.row.name))])])]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-6 flex justify-center"},[r("q-form",[r("q-select",{staticStyle:{width:"150px"},attrs:{type:"number",rules:[function(t){return t>0||"商品數量必須大於0"}],filled:"",label:"購買數量",options:t.options},on:{input:function(r){return t.edit(e.rowIndex)}},model:{value:e.row.amountModel,callback:function(r){t.$set(e.row,"amountModel",t._n(r))},expression:"props.row.amountModel"}})],1)],1),r("div",{staticClass:"col-6 flex justify-center"},[r("h5",{staticClass:"text-center",attrs:{id:"price"}},[t._v("$ "+t._s(e.row.price))])])]),r("div",{staticClass:"row"},[r("div",{staticClass:"col-6 flex justify-center"},[1==t.cart[e.rowIndex].edit?r("q-btn",{attrs:{outline:"",label:"確認數量"},on:{click:function(r){return t.submitProduct(e.rowIndex)}}}):t._e()],1),r("div",{staticClass:"col-6 flex justify-center"},[r("q-btn",{attrs:{outline:"",label:"刪除商品"},on:{click:function(r){return t.delProduct(e.rowIndex)}}})],1)])])],1)],1)]}}])}),r("div",{staticClass:"row q-ma-md",attrs:{id:"check"}},[r("div",{staticClass:"col-12 flex"},[r("h5",[t._v("總金額 : "+t._s(t.totalprice))])]),r("div",{staticClass:"col-12 flex"},[r("q-btn",{attrs:{label:"確認結帳",rounded:"",push:""},on:{click:t.checkout}})],1)])],1)},n=[],s=r("ded3"),c=r.n(s),o=r("c973"),i=r.n(o),u=(r("96cf"),r("dca8"),r("b0c0"),r("a434"),r("d81d"),r("99af"),{name:"Cart",data:function(){for(var t=[],e=0;e<=10;e++)t.push(e);return{filter:"",model:null,options:Object.freeze(t),cart:[],columns:[{name:"name",required:!0,label:"name",align:"left",field:function(t){return t.name},format:function(t){return"".concat(t)},sortable:!1},{name:"amount",label:"amount",field:"amount",sortable:!0},{name:"price",label:"price",field:"price"}]}},computed:{totalprice:function(){return 0===this.cart.length?0:this.cart.reduce((function(t,e){return t+e.amount*e.price}),0)}},methods:{edit:function(t){this.cart[t].edit=!0},delProduct:function(t){var e=this;return i()(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.axios.patch("/users/cart",{product:e.cart[t]._id,amount:0},{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 3:e.cart.splice(t,1),r.next=9;break;case 6:r.prev=6,r.t0=r["catch"](0),e.$swal({icon:"error",title:"錯誤",text:"刪除商品失敗"});case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()},submitProduct:function(t){var e=this;return i()(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.axios.patch("/users/cart",{product:e.cart[t]._id,amount:e.cart[t].amountModel},{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 3:e.$set(e.cart[t],"amount",e.cart[t].amountModel),e.$set(e.cart[t],"edit",!1),r.next=11;break;case 7:r.prev=7,r.t0=r["catch"](0),e.$swal({icon:"error",title:"錯誤",text:"修改商品失敗"}),console.log(e.cart[t].amountModel);case 11:case"end":return r.stop()}}),r,null,[[0,7]])})))()},checkout:function(){var t=this;return i()(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.axios.post("/users/checkout/",{},{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 3:t.$swal({icon:"success",title:"成功",text:"結帳成功,感謝您的光臨"}),t.$router.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"結帳失敗"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}},mounted:function(){var t=this;return i()(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,0!==t.$store.state.user.jwt.token.length){e.next=5;break}return t.$swal({icon:"error",title:"錯誤",text:"請先登入"}),"/"!==t.$route.path&&t.$router.push("/"),e.abrupt("return");case 5:return e.next=7,t.axios.get("/users/cart",{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 7:r=e.sent,a=r.data,t.cart=a.result.map((function(t){return t=c()(c()({},t.product),{},{amount:t.amount}),t.image="".concat("https://renly-eshop.herokuapp.com","/files/").concat(t.image),t.edit=!1,t.amountModel=t.amount,t})),t.cart.length<1&&t.$swal({title:"目前購物車沒有東西，是否要去商品頁面 ?",icon:"question",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"前往商品頁面",denyButtonText:"不用了，謝謝"}).then((function(e){e.isConfirmed?t.$swal("祝您購物愉快","","success",t.$router.push("/adminProduct")):e.isDenied&&t.$swal("眾多商品歡迎參考看看","","success",t.$router.push("/"))})),e.next=15;break;case 13:e.prev=13,e.t0=e["catch"](0);case 15:case"end":return e.stop()}}),e,null,[[0,13]])})))()}}),l=u,d=r("2877"),p=r("9989"),m=r("eaac"),f=r("27f9"),h=r("0016"),w=r("f09f"),x=r("a370"),v=r("068f"),b=r("0378"),k=r("ddd8"),g=r("9c40"),C=r("eebe"),$=r.n(C),q=Object(d["a"])(l,a,n,!1,null,null,null);e["default"]=q.exports;$()(q,"components",{QPage:p["a"],QTable:m["a"],QInput:f["a"],QIcon:h["a"],QCard:w["a"],QCardSection:x["a"],QImg:v["a"],QForm:b["a"],QSelect:k["a"],QBtn:g["a"]})}}]);