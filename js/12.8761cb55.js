(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{d0c8:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",{staticClass:"q-pa-xl",attrs:{id:"adminOrderManage"}},[r("q-dialog",{model:{value:e.edit,callback:function(t){e.edit=t},expression:"edit"}},[r("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[r("h5",{staticClass:"text-center"},[e._v("訂單編輯")]),r("q-form",{staticStyle:{width:"400px"}},[r("q-card-section",[r("q-input",{attrs:{label:"收貨地址"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),r("q-card-section",[r("q-select",{attrs:{outlined:"",options:e.progress,label:"訂單進度"},model:{value:e.form.progress,callback:function(t){e.$set(e.form,"progress",t)},expression:"form.progress"}})],1),r("q-card-section",[r("div",{staticClass:"text-center"},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"送出",type:"submit",color:"primary"},on:{click:e.submitOrder}}),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-ml-sm",attrs:{label:"關閉",type:"reset",color:"primary",flat:""}})],1)])],1)],1)],1),r("q-table",{attrs:{title:"訂單管理",data:e.orders,columns:e.columns,"row-key":"_id"},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"account",attrs:{props:t}},[e._v(e._s(t.row.user.account))]),r("q-td",{key:"_id",attrs:{props:t}},[e._v(e._s(t.row._id))]),r("q-td",{key:"date",attrs:{props:t}},[e._v(e._s(t.row.date))]),r("q-td",{key:"address",attrs:{props:t}},[e._v(e._s(t.row.address))]),r("q-td",{key:"progress",attrs:{props:t}},[e._v(e._s(t.row.progress))]),r("q-td",{key:"products",attrs:{props:t}},e._l(t.row.products,(function(t){return r("div",{staticClass:"row"},[r("hr"),r("div",{staticClass:"col-12"},[r("q-img",{staticStyle:{width:"30%"},attrs:{src:t.product.image}})],1),r("div",{staticClass:"col-12"},[e._v(e._s(t.product.name))]),r("div",{staticClass:"col-12 col-md-6"},[e._v(e._s(t.product.price)+"元")]),r("div",{staticClass:"col-12 col-md-6"},[e._v(e._s(t.amount)+"個")])])})),0),r("q-td",{key:"edit",attrs:{props:t}},[r("q-btn-group",{attrs:{outline:""}},[r("q-btn",{attrs:{outline:"",label:"修改訂單",icon:""},on:{click:function(r){return e.editProduct(t.rowIndex)}}}),r("q-btn",{attrs:{outline:"",label:"刪除訂單",icon:""},on:{click:function(r){return e.delOrder(t.rowIndex)}}})],1)],1)],1)]}}])})],1)},a=[],o=r("6374"),n=r.n(o),i=r("c973"),c=r.n(i),d=(r("96cf"),r("a434"),r("d81d"),r("99af"),{name:"AdminOrderManage",data:function(){return{orders:[],edit:!1,index:0,form:{address:"",amount:0,progress:"已收到訂單"},progress:["已收到訂單","備貨中","出貨中"],columns:[{name:"account",required:!0,label:"使用者名稱",align:"center",field:"account",sortable:!0},{name:"_id",align:"center",label:"訂單編號",field:"_id",sortable:!0},{name:"date",align:"center",label:"訂單日期",field:"date",sortable:!0},{name:"address",label:"收貨地址",field:"address",align:"center"},{name:"progress",label:"訂單進度",field:"progress",align:"center"},{name:"products",label:"訂單內容",field:"products",align:"center"},{name:"edit",label:"管理訂單",field:"edit",align:"center"}]}},methods:{delOrder:function(e){var t=this;return c()(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.axios.delete("/users/orders/"+t.orders[e]._id,{headers:{authorization:"Bearer "+t.$store.state.user.jwt.token}});case 3:t.orders.splice(e,1),r.next=10;break;case 6:r.prev=6,r.t0=r["catch"](0),t.$swal({icon:"error",title:"錯誤",text:"刪除訂單失敗"}),console.log(r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,6]])})))()},editProduct:function(e){this.edit=!0,this.index=e,this.$set(this.form,"address",this.orders[e].address),this.$set(this.form,"progress",this.orders[e].progress)},submitOrder:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.patch("/users/orders/"+e.orders[e.index]._id,e.form,{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 3:e.$set(e.orders[e.index],"address",e.form.address),e.$set(e.orders[e.index],"progress",e.form.progress),t.next=11;break;case 7:t.prev=7,t.t0=t["catch"](0),e.$swal({icon:"error",title:"錯誤",text:"修改商品失敗"}),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()}},mounted:function(){var e=this;return c()(regeneratorRuntime.mark((function t(){var r,s,a,o,i,c,d,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.axios.get("/users/orders",{headers:{authorization:"Bearer "+e.$store.state.user.jwt.token}});case 3:r=t.sent,s=r.data,console.log(s.result),e.orders=s.result.map((function(e){return e.date=new Date(e.date).toLocaleString(),e})),a=n()(e.orders);try{for(a.s();!(o=a.n()).done;){i=o.value,c=n()(i.products);try{for(c.s();!(d=c.n()).done;)l=d.value,l.product.image="".concat("","/files/").concat(l.product.image)}catch(u){c.e(u)}finally{c.f()}}}catch(u){a.e(u)}finally{a.f()}t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](0),console.log(t.t0),e.$swal({icon:"error",title:"錯誤",text:"取得訂單失敗"});case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))()}}),l=d,u=r("2877"),p=r("9989"),m=r("24e8"),f=r("f09f"),g=r("0378"),b=r("a370"),v=r("27f9"),h=r("ddd8"),w=r("9c40"),x=r("eaac"),_=r("bd08"),q=r("db86"),k=r("068f"),y=r("e7a9"),C=r("7f67"),Q=r("eebe"),$=r.n(Q),O=Object(u["a"])(l,s,a,!1,null,null,null);t["default"]=O.exports;$()(O,"components",{QPage:p["a"],QDialog:m["a"],QCard:f["a"],QForm:g["a"],QCardSection:b["a"],QInput:v["a"],QSelect:h["a"],QBtn:w["a"],QTable:x["a"],QTr:_["a"],QTd:q["a"],QImg:k["a"],QBtnGroup:y["a"]}),$()(O,"directives",{ClosePopup:C["a"]})}}]);